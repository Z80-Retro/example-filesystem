;****************************************************************************
;
;    VDP test app
;
;    Copyright (C) 2025 John Winans
;
;    This library is free software; you can redistribute it and/or
;    modify it under the terms of the GNU Lesser General Public
;    License as published by the Free Software Foundation; either
;    version 2.1 of the License, or (at your option) any later version.
;
;    This library is distributed in the hope that it will be useful,
;    but WITHOUT ANY WARRANTY; without even the implied warranty of
;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
;    Lesser General Public License for more details.
;
;    You should have received a copy of the GNU Lesser General Public
;    License along with this library; if not, write to the Free Software
;    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301
;    USA
;
;****************************************************************************

; Enter mode 1 and draw animated characters on the screen

.il_reg:        equ     0x33    ; Interrupt Vector Low Register
.itc_reg:       equ     0x34    ; INT/TRAP Control Register

.vdp_vram:	equ	0x80	; VDP port for accessing the VRAM
.vdp_reg:	equ	0x81	; VDP port for accessing the registers

BDOS:           equ     5       ; CP/M entry
CONOUT:         equ     0x02    ; print character in E
CONRDY:         equ     0x0b    ; a = 0 if no char ready, else 0xff
PSTRING:        equ     0x09    ; print string string from DE will $ found

	org	0x100
        ld      sp,.stack_top

        di

        ;******************************************************************
        ; wait for vblank period
        in      a,(.vdp_reg)    ; discard any existing status
        call    .sync_frame

        ;******************************************************************
        ; init the VDP registers
        ld      hl,.reg_init
        ld      b,.reg_init_len
        ld      c,.vdp_reg
        otir

        ;******************************************************************
        ; put something recognizable into the VRAM
        ld      hl,.vram_raw
        ld      de,0
        ld      bc,.vram_raw_len
        call    .vdp_write

        ;******************************************************************
        ; scroll the screen up and down at 3HZ

.scroller:
        ld      hl,.vdp_name

.scroller_loop:
        ld      b,20                    ; wait for 20 frames to pass
.ss_loop:
        call    .sync_frame
        djnz    .ss_loop

        ld      de,.vdp_name+8*32       ; there are 8 unused lines of space in our name table config
        or      a                       ; clear the carry flag
        push    hl
        sbc     hl,de
        pop     hl
        jp      z,.scroller

        ld      de,32
        add     hl,de                   ; scroll down a line
        ld      de,0x0800               ; target VRAM name table address
        ld      bc,768                  ; actual number of viewable characters
        push    hl
        call    .vdp_write
        call    .kbhit
        pop     hl
        jr      z,.scroller_loop      

        jp      0


        ;******************************************************************
        ; Return with z flag unset if a key has been pressed.
.kbhit:
        ld      c,CONRDY
        call    BDOS
        or      a
        ret


        ;******************************************************************
        ; wait until vsync
.sync_frame:
        in      a,(.vdp_reg)
        and     0x80
        jr      z,.sync_frame
        ret     


        ;********************************************************
        ; copy from RAM to VRAM
        ; HL = RAM address
        ; DE = VRAM address
        ; BC = number of bytes to copy
.vdp_write:
        in      a,(.vdp_reg)                    ; read the status register to reset the reg fsm
        ld      a,e
        out     (.vdp_reg),a                    ; VRAM address LSB
        ld      a,d
        or      0x40                            ; VRAM MSB (with 01 in msbs)
        out     (.vdp_reg),a                    ; VRAM address MSB

        ld      d,b
        ld      e,c
        ld      c,.vdp_vram

        ld      a,d
        or      a
        jr      z,.wr_resid
        ld      b,0             ; 256 bytes
.wr_256:
        otir
        dec     d
        jr      nz,.wr_256

.wr_resid:
        ; is there any residual ?
        ld      a,e
        or      a
        ret     z               ; no? then we are done

        ld      b,e
        otir
        ret



; This is the same data as used in:  2067-Z8S180/fpga/nouveau-vdp99/z80_vdp99_tb.v
.vram_raw:
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x10, 0x00
	db	0x24, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x24, 0x24, 0x7e, 0x24, 0x7e, 0x24, 0x24, 0x00
	db	0x08, 0x3e, 0x40, 0x7e, 0x02, 0x7c, 0x10, 0x00
	db	0x20, 0x52, 0x24, 0x08, 0x12, 0x25, 0x02, 0x00
	db	0x18, 0x20, 0x20, 0x3a, 0x44, 0x42, 0x3d, 0x00
	db	0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00
	db	0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x00
	db	0x00, 0x08, 0x2a, 0x1c, 0x2a, 0x08, 0x00, 0x00
	db	0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x10
	db	0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x00
	db	0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00
	db	0x1c, 0x22, 0x41, 0x41, 0x41, 0x22, 0x1c, 0x00
	db	0x0c, 0x14, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x30, 0x40, 0x7f, 0x00
	db	0x7f, 0x02, 0x04, 0x1e, 0x01, 0x41, 0x3e, 0x00
	db	0x0e, 0x12, 0x22, 0x42, 0x7f, 0x02, 0x02, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x01, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x40, 0x7e, 0x41, 0x41, 0x3e, 0x00
	db	0x3f, 0x41, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x41, 0x3e, 0x41, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x10
	db	0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00
	db	0x00, 0x00, 0x7e, 0x00, 0x7e, 0x00, 0x00, 0x00
	db	0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x00, 0x08, 0x08, 0x00
	db	0x1e, 0x21, 0x4f, 0x51, 0x4f, 0x20, 0x1f, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x41, 0x41, 0x7e, 0x00
	db	0x3e, 0x41, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x7c, 0x42, 0x41, 0x41, 0x41, 0x42, 0x7c, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x7f, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x40, 0x4f, 0x41, 0x41, 0x3f, 0x00
	db	0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x41, 0x00
	db	0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00
	db	0x01, 0x01, 0x01, 0x01, 0x01, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x42, 0x7c, 0x42, 0x41, 0x41, 0x00
	db	0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x77, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00
	db	0x7e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x45, 0x42, 0x3d, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x48, 0x44, 0x43, 0x00
	db	0x3e, 0x41, 0x40, 0x3e, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00
	db	0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x41, 0x42, 0x44, 0x48, 0x30, 0x00
	db	0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x77, 0x00
	db	0x41, 0x41, 0x22, 0x1c, 0x22, 0x41, 0x41, 0x00
	db	0x41, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x02, 0x04, 0x08, 0x10, 0x20, 0x7f, 0x00
	db	0x1c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1c, 0x00
	db	0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00
	db	0x1c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1c, 0x00
	db	0x10, 0x38, 0x38, 0x54, 0x10, 0x10, 0x10, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff
	db	0x1f, 0x20, 0x20, 0x7c, 0x20, 0x21, 0x7e, 0x00
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x42, 0x3d, 0x00
	db	0x40, 0x40, 0x7c, 0x42, 0x42, 0x42, 0x7c, 0x00
	db	0x00, 0x00, 0x3e, 0x40, 0x40, 0x40, 0x3e, 0x00
	db	0x02, 0x02, 0x3e, 0x42, 0x42, 0x42, 0x3e, 0x00
	db	0x00, 0x00, 0x3c, 0x42, 0x7e, 0x40, 0x3e, 0x00
	db	0x0e, 0x10, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x00
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x3e, 0x02, 0x3c
	db	0x40, 0x40, 0x7c, 0x42, 0x42, 0x42, 0x42, 0x00
	db	0x10, 0x00, 0x10, 0x10, 0x10, 0x10, 0x0c, 0x00
	db	0x04, 0x00, 0x04, 0x04, 0x04, 0x04, 0x44, 0x38
	db	0x20, 0x20, 0x22, 0x24, 0x38, 0x24, 0x22, 0x00
	db	0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x0c, 0x00
	db	0x00, 0x00, 0x77, 0x49, 0x49, 0x49, 0x49, 0x00
	db	0x00, 0x00, 0x7c, 0x42, 0x42, 0x42, 0x42, 0x00
	db	0x00, 0x00, 0x3c, 0x42, 0x42, 0x42, 0x3c, 0x00
	db	0x00, 0x00, 0x7c, 0x42, 0x42, 0x7c, 0x40, 0x40
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x3e, 0x02, 0x02
	db	0x00, 0x00, 0x7c, 0x42, 0x40, 0x40, 0x40, 0x00
	db	0x00, 0x00, 0x3e, 0x40, 0x3c, 0x02, 0x7c, 0x00
	db	0x10, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x0e, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x42, 0x42, 0x3c, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x44, 0x48, 0x30, 0x00
	db	0x00, 0x00, 0x49, 0x49, 0x49, 0x49, 0x77, 0x00
	db	0x00, 0x00, 0x42, 0x24, 0x18, 0x24, 0x42, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x42, 0x3e, 0x02, 0x3c
	db	0x00, 0x00, 0x7e, 0x04, 0x18, 0x20, 0x7e, 0x00
	db	0x06, 0x08, 0x08, 0x30, 0x08, 0x08, 0x06, 0x00
	db	0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00
	db	0x30, 0x08, 0x08, 0x06, 0x08, 0x08, 0x30, 0x00
	db	0x00, 0x14, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x3c, 0x42, 0x99, 0xa1, 0xa1, 0x99, 0x42, 0x3c
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x10, 0x00
	db	0x24, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x24, 0x24, 0x7e, 0x24, 0x7e, 0x24, 0x24, 0x00
	db	0x08, 0x3e, 0x40, 0x7e, 0x02, 0x7c, 0x10, 0x00
	db	0x20, 0x52, 0x24, 0x08, 0x12, 0x25, 0x02, 0x00
	db	0x18, 0x20, 0x20, 0x3a, 0x44, 0x42, 0x3d, 0x00
	db	0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00
	db	0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x00
	db	0x00, 0x08, 0x2a, 0x1c, 0x2a, 0x08, 0x00, 0x00
	db	0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x10
	db	0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x00
	db	0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00
	db	0x1c, 0x22, 0x41, 0x41, 0x41, 0x22, 0x1c, 0x00
	db	0x0c, 0x14, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x30, 0x40, 0x7f, 0x00
	db	0x7f, 0x02, 0x04, 0x1e, 0x01, 0x41, 0x3e, 0x00
	db	0x0e, 0x12, 0x22, 0x42, 0x7f, 0x02, 0x02, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x01, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x40, 0x7e, 0x41, 0x41, 0x3e, 0x00
	db	0x3f, 0x41, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x41, 0x3e, 0x41, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x10
	db	0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00
	db	0x00, 0x00, 0x7e, 0x00, 0x7e, 0x00, 0x00, 0x00
	db	0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x00, 0x08, 0x08, 0x00
	db	0x1e, 0x21, 0x4f, 0x51, 0x4f, 0x20, 0x1f, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x41, 0x41, 0x7e, 0x00
	db	0x3e, 0x41, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x7c, 0x42, 0x41, 0x41, 0x41, 0x42, 0x7c, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x7f, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x40, 0x4f, 0x41, 0x41, 0x3f, 0x00
	db	0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x41, 0x00
	db	0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00
	db	0x01, 0x01, 0x01, 0x01, 0x01, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x42, 0x7c, 0x42, 0x41, 0x41, 0x00
	db	0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x77, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00
	db	0x7e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x45, 0x42, 0x3d, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x48, 0x44, 0x43, 0x00
	db	0x3e, 0x41, 0x40, 0x3e, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00
	db	0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x41, 0x42, 0x44, 0x48, 0x30, 0x00
	db	0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x77, 0x00
	db	0x41, 0x41, 0x22, 0x1c, 0x22, 0x41, 0x41, 0x00
	db	0x41, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x02, 0x04, 0x08, 0x10, 0x20, 0x7f, 0x00
	db	0x1c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1c, 0x00
	db	0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00
	db	0x1c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1c, 0x00
	db	0x10, 0x38, 0x38, 0x54, 0x10, 0x10, 0x10, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff
	db	0x1f, 0x20, 0x20, 0x7c, 0x20, 0x21, 0x7e, 0x00
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x42, 0x3d, 0x00
	db	0x40, 0x40, 0x7c, 0x42, 0x42, 0x42, 0x7c, 0x00
	db	0x00, 0x00, 0x3e, 0x40, 0x40, 0x40, 0x3e, 0x00
	db	0x02, 0x02, 0x3e, 0x42, 0x42, 0x42, 0x3e, 0x00
	db	0x00, 0x00, 0x3c, 0x42, 0x7e, 0x40, 0x3e, 0x00
	db	0x0e, 0x10, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x00
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x3e, 0x02, 0x3c
	db	0x40, 0x40, 0x7c, 0x42, 0x42, 0x42, 0x42, 0x00
	db	0x10, 0x00, 0x10, 0x10, 0x10, 0x10, 0x0c, 0x00
	db	0x04, 0x00, 0x04, 0x04, 0x04, 0x04, 0x44, 0x38
	db	0x20, 0x20, 0x22, 0x24, 0x38, 0x24, 0x22, 0x00
	db	0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x0c, 0x00
	db	0x00, 0x00, 0x77, 0x49, 0x49, 0x49, 0x49, 0x00
	db	0x00, 0x00, 0x7c, 0x42, 0x42, 0x42, 0x42, 0x00
	db	0x00, 0x00, 0x3c, 0x42, 0x42, 0x42, 0x3c, 0x00
	db	0x00, 0x00, 0x7c, 0x42, 0x42, 0x7c, 0x40, 0x40
	db	0x00, 0x00, 0x3e, 0x42, 0x42, 0x3e, 0x02, 0x02
	db	0x00, 0x00, 0x7c, 0x42, 0x40, 0x40, 0x40, 0x00
	db	0x00, 0x00, 0x3e, 0x40, 0x3c, 0x02, 0x7c, 0x00
	db	0x10, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x0e, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x42, 0x42, 0x3c, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x44, 0x48, 0x30, 0x00
	db	0x00, 0x00, 0x49, 0x49, 0x49, 0x49, 0x77, 0x00
	db	0x00, 0x00, 0x42, 0x24, 0x18, 0x24, 0x42, 0x00
	db	0x00, 0x00, 0x42, 0x42, 0x42, 0x3e, 0x02, 0x3c
	db	0x00, 0x00, 0x7e, 0x04, 0x18, 0x20, 0x7e, 0x00
	db	0x06, 0x08, 0x08, 0x30, 0x08, 0x08, 0x06, 0x00
	db	0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00
	db	0x30, 0x08, 0x08, 0x06, 0x08, 0x08, 0x30, 0x00
	db	0x00, 0x14, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x3c, 0x42, 0x99, 0xa1, 0xa1, 0x99, 0x42, 0x3c
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x10, 0x00
	db	0x24, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x24, 0x24, 0x7e, 0x24, 0x7e, 0x24, 0x24, 0x00
	db	0x08, 0x3e, 0x40, 0x7e, 0x02, 0x7c, 0x10, 0x00
	db	0x20, 0x52, 0x24, 0x08, 0x12, 0x25, 0x02, 0x00
	db	0x18, 0x20, 0x20, 0x3a, 0x44, 0x42, 0x3d, 0x00
	db	0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00
	db	0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x00
	db	0x00, 0x08, 0x2a, 0x1c, 0x2a, 0x08, 0x00, 0x00
	db	0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x10
	db	0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x00
	db	0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00
	db	0x1c, 0x22, 0x41, 0x41, 0x41, 0x22, 0x1c, 0x00
	db	0x0c, 0x14, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x30, 0x40, 0x7f, 0x00
	db	0x7f, 0x02, 0x04, 0x1e, 0x01, 0x41, 0x3e, 0x00
	db	0x0e, 0x12, 0x22, 0x42, 0x7f, 0x02, 0x02, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x01, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x40, 0x7e, 0x41, 0x41, 0x3e, 0x00
	db	0x3f, 0x41, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x41, 0x3e, 0x41, 0x41, 0x3e, 0x00
	db	0x3e, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x00
	db	0x00, 0x00, 0x08, 0x08, 0x00, 0x08, 0x08, 0x10
	db	0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00
	db	0x00, 0x00, 0x7e, 0x00, 0x7e, 0x00, 0x00, 0x00
	db	0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x00
	db	0x3e, 0x41, 0x01, 0x0e, 0x00, 0x08, 0x08, 0x00
	db	0x1e, 0x21, 0x4f, 0x51, 0x4f, 0x20, 0x1f, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x41, 0x41, 0x7e, 0x00
	db	0x3e, 0x41, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x7c, 0x42, 0x41, 0x41, 0x41, 0x42, 0x7c, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x7f, 0x00
	db	0x7f, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x40, 0x4f, 0x41, 0x41, 0x3f, 0x00
	db	0x41, 0x41, 0x41, 0x7f, 0x41, 0x41, 0x41, 0x00
	db	0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00
	db	0x01, 0x01, 0x01, 0x01, 0x01, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x42, 0x7c, 0x42, 0x41, 0x41, 0x00
	db	0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x3e, 0x00
	db	0x77, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00
	db	0x7e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x40, 0x40, 0x40, 0x00
	db	0x3e, 0x41, 0x41, 0x41, 0x45, 0x42, 0x3d, 0x00
	db	0x7e, 0x41, 0x41, 0x7e, 0x48, 0x44, 0x43, 0x00
	db	0x3e, 0x41, 0x40, 0x3e, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00
	db	0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x3e, 0x00
	db	0x41, 0x41, 0x41, 0x42, 0x44, 0x48, 0x30, 0x00
	db	0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x77, 0x00
	db	0x41, 0x41, 0x22, 0x1c, 0x22, 0x41, 0x41, 0x00
	db	0x41, 0x41, 0x41, 0x3f, 0x01, 0x41, 0x3e, 0x00
	db	0x7f, 0x02, 0x04, 0x08, 0x10, 0x20, 0x7f, 0x00
	db	0x1c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1c, 0x00
	db	0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00
	db	0x1c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1c, 0x00
	db	0x10, 0x38, 0x38, 0x54, 0x10, 0x10, 0x10, 0x00
	db	0x3c, 0x42, 0x99, 0xa1, 0xa1, 0x99, 0x42, 0x3c

.vdp_name:
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x0f
	db	0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f
	db	0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x4d, 0x4e, 0x4f, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x5f
	db	0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x7b, 0x7c, 0x7d, 0x7e, 0x7f
	db	0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x0f, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
	db	0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a

	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a
	db	0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a

	db	0x07, 0x46, 0x75, 0x70, 0x34, 0x45, 0x56, 0x67, 0x78, 0x89, 0x9a, 0xab, 0xbc, 0xcd, 0xee, 0xff, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
.vram_raw_len:      equ     $-.vram_raw


        ; VDP register init values
.reg_init:
        db      0x00,0x80       ; graphics mode 1
        db      0x40,0x81       ; graphics mode 1, enable screen
        db      0x02,0x82       ; name table 0x0800 - 0x0bff
        db      0x30,0x83       ; color table 0x0c00 - 0x0c20
        db      0x00,0x84       ; pattern table 0x0000 - 0x07ff
        db      0xff,0x85       ; sprite attribute table 0x3f80 - 0x3fff
        db      0xff,0x86       ; sprite pattern table 0x3800 - 0x3fff
        db      0x3f,0x87       ; fg/bg colors
.reg_init_len:   equ    $-.reg_init

        org     $+0x200
.stack_top:

